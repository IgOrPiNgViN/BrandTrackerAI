@startuml
title Activity — сбор, предобработка и визуализация отзывов

skinparam shadowing false
skinparam activity {
  BackgroundColor #FFFFFF
  BorderColor #2F3A4A
  ArrowColor #2F3A4A
  BarColor #2F3A4A
  StartColor #2F3A4A
  EndColor #2F3A4A
  DiamondBackgroundColor #F6F7F9
  DiamondBorderColor #2F3A4A
}

|Пользователь|
start
:Ввод URL и параметров\n(лимит/кол-во страниц);

|Веб‑сайт (интерфейс)|
:Отправка запроса\nPOST /parse (url, review_amount);

|Backend API|
:Валидация параметров;
:Проверка URL;

if (URL/параметры корректны?) then (нет)
  :Сформировать ответ 400\n(описание причины);
  |Веб‑сайт (интерфейс)|
  :Показать сообщение об ошибке;
  stop
else (да)
endif

:Запуск сбора по URL;

|Парсер (загрузка и извлечение)|
:Запросить страницу с отзывами;
while (Есть следующая страница\nи лимит не исчерпан?) is (да)
  :GET страницы отзывов\n(с пагинацией при необходимости);
endwhile (нет)
:Извлечение отзывов\n(текст/рейтинг/автор/дата);
:Передать список отзывов;

|Предобработка (нормализация)|
:Очистка и нормализация\nформатов полей;
:Удаление явных дублей\n(если применимо);

|CSV‑хранилище (data/*.csv)|
:Запись результатов в CSV\n(фиксированные колонки);

|Backend API|
:Расчёт метрик;
:Подготовка графиков;

|Модуль визуализации|
:Чтение данных из CSV;
:Построение графиков;

|Backend API|
:Ответ 200:\nCSV + метрики/графики\n(или ссылки на файлы);

|Веб‑сайт (интерфейс)|
:Показ результата;
:Кнопка «Скачать CSV»;

|Пользователь|
stop
@enduml

